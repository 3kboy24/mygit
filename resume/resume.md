### ceph on arm
- 作业内容
    - Arm分布式文件存储服务器，作业内容包括硬件选型、系统选型与定制、内核编译与裁剪、ceph的交叉编译、集群的部署、维护、测试、优化。
    - ceph是开源的分布式存储系统，支持块存储、文件存储、对象存储。
- 硬件选型
    - Marvell ARMADA-38x
    - 双核CPU（与或运算加速器）
    - 2G内存（OSD）
    - 双千兆网卡
        - 集群网络
        - 外部网络
    - 双硬盘接口
    - 电源管理
        - ipmitool的使用
- 系统
    - 系统选型
        - Ubuntu 14.04 armhf
    - 内核
        - 内核的编译裁剪>3.13.0
        - 内核模块的追加
    - Bootloader的使用
        - dtb、zimage加载
        - nfs根文件系统加载
    - 系统备份与恢复
- 交叉编译
    - 交叉编译工具链选型
        - gcc4.8 对C++11的支持
        - cmake4.8.0-rc2 升级到最新版
    - 交叉编译环境配置
        - Makefile解析、修改
        - Cmake环境配置
    - Troubleshooting
        - boost库编译
        - 容量削减 strip
        - ceph对交叉编译支持性的改善
            - 缺少库、缺少头文件
        - ceph交叉编译安装支持性的改善
- ceph软件
    - 部署
        - ceph-deploy工具使用，源代码解析、调试
        - Shell脚本编写
        - 自动化运维工具ansible使用
        - ssh工具使用
            - sshkeygen、ssh-copy-id
            - 免密登录
        - ntp部署
        - iptables使用、6789端口开放
    - 维护
    - TroubleShooting
        - linux log的解析
            - /var/log/ceph/*
            - /var/log/dmesg
        - ceph log各级别log的打开与关闭
        - 权限问题
            - /var/log下文件权限不正确，导致的log无法生成
        - 文件的存在性问题
        - 程序自启动
            - /etc/init/*.conf
            - /var/log/upstart解析
        - 硬盘开机自动挂载
            - /etc/fstab
            - /lib/udev/rules.d/*.rules
        - rbd 4k 随机写测试时slow request问题
            - 在测试该问题过程中发现产生slow reqest的节点，dmesg中有ata命令FLUSH_CACHE_EXT有超时日志，通过查阅ata命令规范，发现该命令执行时间可能需要30S以上，因为osd 超时判定默认值也是30S，所以这个问题，我们判读是硬盘相关问题。硬盘本身是由希捷供应商提供，硬盘发生错误的可能性比较小。通过查看相关文档，可能与供电和电源管理策略有关，由于6台服务器结合测试时候，slow request通常发生在ARMS005服务器上，所以判断是ARMS005服务器供电问题。
        - 进行读写测试时候，一段时间后发生OOM
            - 背景
                - 一块板子，2G内存，2 OSD， Bluestore， Luminous 12.2.2， 10T+10T HHD， ubuntu 14.04
            - 现象
                - fio读写测试一段时间后osd oom，并有tcmalloc频繁的进行内存回收工作
            - 关于参数调整的尝试
                - bluestore_cache_size 把bluestore cache size 从默认值1GB调整到128MB
                - bluestore_cache_trim_interval 调整bluestore cache内存的释放频率，从每隔0.2S释放调整到0.04S
                - bluestore_default_buffered_read 取消buffered read，从默认值true调整到false
                - 修改TCMALLOC_MAX_TOTAL_THREAD_CACHE_BYTES，将链接了tcmalloc进程的程序，线程间共享cache的大小从128MB调整到18MB
        - ceph-disk格式化硬盘超时
            - 在针对大容量硬盘ceph-disk激活硬盘时，发生time out（300s），因为ceph-disk有bug，修改ceph-disk源代码，延长timeout时间，完成激活
            
    - 测试
        - fio测试
            - 单台服务器测试，多台服务器测试（OSD节点增多）
            - 单个客户端测试，多个客户端测试
            - rbd
                - 4k rand
                - 4m mix
                - 4m seq
            - cephfs
                - 4k rand
                - 4m mix
                - 4m seq
            - IOPS
            - 吞吐量
        - dd测试
        - iperf网络测试
        - osd perf集群网络测试
        - 单节点拔出测试
    - 优化
        - 文件系统的选型 ext4/xfs/btrfs
        - 内网、外网隔离
        - pg、pgp调整
        - crushmap调整
            - 故障域的分离
        - ssd
            - Journal
            - Cache Tier
        - 冗余模式纠删码
    - 监控 
        - grafana+graphite+carbon
            - python -> carbon服务 -> graphite -> grafana
        - 监控数据类别
            - Cluster
                - IO Bytes/S
                    - 每秒钟写入字节数
                    - 每秒钟读出字节数
                    - 每秒钟数据字节数
                - IOPS
                    - 每秒钟写操作数量
                    - 每秒钟读操作数量
                    - 每秒钟恢复对象数量
                - OSD Perf
                    - Apply latency
                    - Commit latency
                - Missed Objects
                - Bytes Used
                - OSD number
                    - osd in
                    - osd up
                    - osd down
                    - osd out
                - IOPS与吞吐量的关系
                    - 每秒I/O吞吐量 ＝ IOPS* 平均I/OSIZE
            - Host
                - eth0/eth1.in
                - eth0/eth1.out
                - sda/sdb.read
                - sda/sdb.write
                - load1&load2/load3
            - OSD
                - google-perftools
            - dmesg
- 其他
    - vim使用
    - git使用
    - gdb使用
    - tftp服务器搭建与使用
### Intalogic
- 作业内容
    - Intalogci Run端CPU更换
    - Run端本身相当于一个解释器+编译器+执行器，Editor端用户编写ladder程序，Editor端生成中间码，通过串口Editor将中间码传送给Run端，Run端解析中间码，生成对应的机器码，将机器码写入内存的执行代码Section，CPU执行指针从执行Section开始执行机器码。
- 硬件环境
    - 瑞萨H8SX2600->RX630
    - H8SX2600
        - CISC复杂指令集
        - 没有奇数字节指令
    - RX630
        - RISC简单指令集
        - 有奇数字节指令
    - CPU对内存的写入都是以Word为单位
- IDE
    - CubeSuite++

